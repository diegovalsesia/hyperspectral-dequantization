# High-throughput Onboard Hyperspectral Image Compression with Ground-based CNN Reconstruction
Code from paper High-throughput Onboard Hyperspectral Image Compression with Ground-based CNN Reconstruction, IEEE Transactions on Geoscience and Remote Sensing, 2019. The code implements image restoration for the bounded absolute error objective.

BibTex reference:
```
@article{valsesia2019high,
  title={High-throughput Onboard Hyperspectral Image Compression with Ground-based CNN Reconstruction},
  author={Valsesia, Diego and Magli, Enrico},
  journal={IEEE Transactions on Geoscience and Remote Sensing},
  year={2019},
  volume={},
  number={},
  pages={},
  doi={10.1109/TGRS.2019.2927434}, 
}
```

# Requirements

  - Python 3.6
  - Pytorch 0.4.0
  
Python packages are listed in requirements.txt. Install them with:
```
pip install -r requirements.txt
```

# Data format
Training data must be placed in the _Data/prequantization/train/Q61/_ directory. Substitute _prequantization_ with _ccsds_ when training the model to reconstruct from CCSDS 123.0-B-2, and _Q61_ with the desired quantization step size. 
The directory must contain two files:
- _all\_Q61.mat_ : the noisy data, e.g. the output of the prequantization method after dequantization, or the output of the CCSDS-123.0-B-2 lossy decompressor. A MAT v7.3 file generated by matlab (or a compatible h5 archive) containing a 4-D tensor named _PallQ_ of type uint16 of size number of patches x 32 x 32 x 8;
- _all\_orig.mat_ : the clean data. A MAT v7.3 file generated by matlab (or a compatible h5 archive) containing a 4-D tensor named _Pall_ of type uint16 of size number of patches x 32 x 32 x 8. Notice that they must be the clean versions of the same patches stored in _all_Q61.mat_, in the same order.

Test data must be placed in the _Data/prequantization/test/Q61/_ directory. Substitute _prequantization_ with _ccsds_ when using the model to reconstruct from CCSDS 123.0-B-2, and _Q61_ with the desired quantization step size. The file with the noisy data must be:
- _scene\_name\_Q61.mat_: scene\_name is the same name specified in the _launcher\_test.sh_ script.  The file is MAT v7.3 file generated by matlab (or a compatible h5 archive) containing an image to be restored as a 3-D tensor (lines x columns x bands) with type _single_ and named _img\_q_.

# Training
Run the following script:
```
./launcher_train.sh
```
Customize the paramters in the script to train the desired model and quantization step size. A validation file must be provided for the _test\_quant\_filename_ parameter and place in the directory specified by _test\_dir_. This file has the same format as testing data. If a _start\_iter_ file with the iteration number if found in the _log\_dir_ training will load the last checkpoint from the _Results/prequantization/Q61/saved\_models_ directory and resume from there.

# Testing
Run the following script:
```
./launcher_test.sh
```
Customize the paramters in the script to test the desired model and quantization step size.

# Pretrained models
Pretrained networks are provided for the both the _ccsds_ and _prequantization_ algorithms for the folowing quantization step size: 3,7,11,15,21,31,41,61,101. They can be found in the _Results_ directories.
A decompressed test image is available under directory _Data/prequantization/test/Q61/_.
